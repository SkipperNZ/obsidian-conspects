[[CV]]




# Лекция 9
Tracking (SORT, DeepSORT, Kalman)

Задача: Мы хотим построить ассоциации между баундингбоксами от кадра к кадру на видео. 
Можно повышать качество детекции за счет использования трекеров.

Мы дадим каждому детектируемому баундинг боксу id 
![[Pasted image 20220628222008.png]]

Помимо всего мы хотим с помощью трекеров чинить некоторые ошибки  детектора



**Решение задачи "В лоб"**

Можно строить ассоциацию с помощью IoU(intersection over union)
Посмотрим на bboxes с предыдущего кадра и на текущем кадре считаем с ними IoU, получится матрица, насколько легко сматчить баундинг боксы друг с другом 

Ассоциацию молжо построить с помощью "венгерского алгоритма"

![[Pasted image 20220629110953.png]]

Детекция i и трек j
трек - какой то id с которым ассоциированы детекции в прошлом.
У нас какое то IoU между детекциями и треками, мы применяем венгерский алгоритм и получаем лучшее совпадение треков с детекциями.
![[Pasted image 20220629113052.png]]

По асимптотике, это все работает долго, но за счет того что объектов в целом не много то можно гонять венгерский алгоритм хоть на каждом кадре, все должно быть ок.


### Kalman Filter
Фильтр калмана можно использовать практически везде, где есть какие то динамические системы.

Основная идея 
**Data fusion(объединение данных)** - Мы хотим объединять шумное предсказание нашей модели и какие то шумные измерения

С чем работает фильтр калмана.
У нас есть какой то объект, который можно представить в виде вектора параметров (state vector).

Мы хотим итерироваться во времени и на каждом шаге предсказывать нашей моделью какой то новый state vector и корректировать предсказания модели зная какие то замеры из реального мира

Фильтр калмана дает оценку максимального правдоподобия на значения параметров
![[Pasted image 20220629123310.png]]


**Пример**
Оригинал статьи 
https://www.bzarg.com/p/how-a-kalman-filter-works-in-pictures/

У нас есть тележка, которая может двигаться вдоль одной оси.
![[Pasted image 20220629193650.png]]

Эту тележку будем представлять в виде вектора, у которой есть позиция и скорость:
![[Pasted image 20220629211113.png]]
Введём еще матрицу ковариаций:
Выражаем информацию о тележке в виде нормального распределения 
Pk - ковариационная матрица, наша неопределенность относительно вектора состояния.
Она в общем случае не диагональная так как позиция и скорость могут быть скорелированы.  (при большей скорости позиции быстрее меняются)
![[Pasted image 20220630151914.png]]
![[Pasted image 20220630152912.png]]

Как переписать во времени преобразование одного state vector в другой.
Можно рассмотреть обычный закон кинематики, и если у нас постоянная скорость то позиция изменяется следующим образом.
![[Pasted image 20220630153522.png]]
А если представить в матричном виде то 
![[Pasted image 20220630153752.png]]

$\large F_{k}$ - prediction matrix и она зависит от среды в которой мы работаем, она задается руками априорно.

Отсюда видно что фильтры калмана моделируют только линейные процессы.
При этом у нас может менятся неуверенность 
Матрица А это как раз Fk
![[Pasted image 20220630154653.png]]

И вот финальное выражение:
![[Pasted image 20220630154745.png]]

























